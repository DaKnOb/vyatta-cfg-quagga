#
# Config template for
# protocols/static/interface-route/<prefix>/next-hop-interface
#

tag:

type: txt

help: Set the next-hop interface

#
# Argument must be the name of an interface on the system.  PPP interfaces
# only come into existance when they come up.  Allow interface routes
# via them to be configured even though the link may not be up right now.
# We need a special case for multilink interfaces because their names
# are not coded into the name of the PPP config file in /etc/ppp/peers.
#
syntax:expression: exec " \
        IFNAME=$VAR(@) ; \
        if [ ! -e /sys/class/net/$IFNAME ]; then \
	  if [ \"${IFNAME::5}\" != \"pppoa\" -a \"${IFNAME::5}\" != \"pppoe\" \
	    -a \"${IFNAME::3}\" != \"wan\" \
	    -a \"${IFNAME::2}\" != \"ml\" ]; then \
		echo interface $IFNAME doesn\\'t exist on this system ; \
		exit 1 ; \
          fi ; \
          if [ ! -e /etc/ppp/peers/${IFNAME} -a \"$IFNAME\" != \"ml0\" \
	       -a \"$IFNAME\" != \"ml1\" ]; then \
		echo PPP interface $IFNAME doesn\\'t exist on this system ; \
		exit 1 ; \
	  fi ; \
        fi ; "

delete:expression: "touch /tmp/static.$PPID"

end:expression: "if [ -f \"/tmp/static.$PPID\" ]; then \
         ${vyatta_sbindir}/vyatta-vtysh.pl -c \"configure terminal\" -c \"no ip route $VAR(../@) $VAR(@)\" ; \
         rm /tmp/static.$PPID; \
      else \
         if [ -n \"$VAR(./distance/@)\" ]; then \
	    DIST=\"$VAR(./distance/@)\"; \
         fi; \	       
         ${vyatta_sbindir}/vyatta-vtysh.pl -c \"configure terminal\" -c \"ip route $VAR(../@) $VAR(@) $DIST \" ; \
      fi; "

