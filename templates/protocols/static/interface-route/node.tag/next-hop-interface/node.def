tag:
type: txt
help: Next-hop interface [REQUIRED]
# show all current interface
# but syntax accepts any interface since it may exist later (ppp etc)
allowed: ${vyatta_sbindir}/vyatta-interfaces.pl --show all


end:
  if [[ -z "$VAR(./disable)" ]]
  then
    if [[ ${COMMIT_ACTION} = 'DELETE' ]]
    then
      # Check that there is still a next-hop-interface if the parent is not deleted
      ARR=( $(cli-shell-api listNodes protocols static interface-route $VAR(../@) next-hop-interface) )
      cli-shell-api exists protocols static interface-route $VAR(../@)
      RETVAL_PARENT=$?
      if [ ${#ARR} -eq 0 ] && [ $RETVAL_PARENT -eq 0 ]
      then
         echo "Must add a next-hop-interface for route $VAR(../@)"
         exit 1
      fi

      vtysh -c "configure terminal" \
                   -c "no ip route $VAR(../@) $VAR(@)"
    else
      if [[ -n "$VAR(./distance/@)" ]]
      then
        DIST="$VAR(./distance/@)"
      fi
      vtysh -c "configure terminal" \
                   -c "ip route $VAR(../@) $VAR(@) $DIST";
    fi
  else
      vtysh -c "configure terminal" \
                   -c "no ip route $VAR(../@) $VAR(@)"
  fi
