tag:

type: ipv6

help: Next-hop IPv6 router [REQUIRED]

end:
  if [[ -z "$VAR(./disable)" ]]
  then
    if [[ ${COMMIT_ACTION} = 'DELETE' ]]
    then
      # Check that there is still a next-hop or blackhole if the parent is not deleted
      ARR=( $(cli-shell-api listNodes protocols static route6 $VAR(../@) next-hop) )
      cli-shell-api exists protocols static route6 $VAR(../@) blackhole
      RETVAL_BH=$?
      cli-shell-api exists protocols static route6 $VAR(../@)
      RETVAL_PARENT=$?
      if [ ${#ARR} -eq 0 ] && [ $RETVAL_BH -eq 1 ] && [ $RETVAL_PARENT -eq 0 ]
      then
         echo "Must add either a next-hop or blackhole for route $VAR(../@)"
         exit 1
      fi

      if ${vyatta_sbindir}/vyatta-gateway-static_route-check.pl \
          "$VAR(../@)" "$VAR(@)"
      then
	quagga_conf=`vtysh -c "show running-config" | \
            grep "^ipv6 route $VAR(../@) $VAR(@)"`
	ifname=`echo $quagga_conf | awk '{print $5}'`

        vtysh -c "configure terminal" \
                     -c "no ipv6 route $VAR(../@) $VAR(@) $ifname"
      fi
    else
      if [[ -n "$VAR(./distance/@)" ]]
      then
        DIST="$VAR(./distance/@)"
      fi

      if [[ -n "$VAR(./interface/@)" ]]
      then
        INTERFACE="$VAR(./interface/@)"
      fi

      vtysh -c "configure terminal" \
                   -c "ipv6 route $VAR(../@) $VAR(@) $INTERFACE $DIST";
    fi
  else
    if ${vyatta_sbindir}/vyatta-gateway-static_route-check.pl \
        "$VAR(../@)" "$VAR(@)"
    then
      vtysh -c "configure terminal" \
                   -c "no ipv6 route $VAR(../@) $VAR(@)"
    fi
  fi
